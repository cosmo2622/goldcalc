<script>
async function fetchGoldPrice() {
  try {
    const apiKey = 'Fvho4fUUxq5t81tD1udPjat3IZBtAn%2BsGoK%2BEukltAH2VZ3FZ%2Fnx58l04rCGgHwt8rCmNKFkJoN8Braa1lWWyQ%3D%3D';
    const apiURL = `https://api.odcloud.kr/api/GetKrGoldPrice/v1/latest?serviceKey=${apiKey}`;
    const corsProxy = `https://corsproxy.io/?${encodeURIComponent(apiURL)}`;
    const response = await fetch(corsProxy);
    const data = await response.json();
    return data.data[0].price;
  } catch (error) {
    alert('데이터를 불러오는 중 오류가 발생했습니다. 잠시 후 다시 시도해주세요.');
    console.error(error);
  }
}

async function calculate() {
  const grams = document.getElementById('grams').value;
  if (grams <= 0) {
    alert('올바른 금 무게를 입력하세요.');
    return;
  }
  const goldPricePerGram = await fetchGoldPrice();
  if (!goldPricePerGram) return;
  const totalPrice = goldPricePerGram * grams;
  document.getElementById('result').innerHTML = `
    <table>
      <tr>
        <th>금 무게 (g)</th>
        <th>1g당 가격 (원)</th>
        <th>총 가격 (원)</th>
      </tr>
      <tr>
        <td>${grams}</td>
        <td>${goldPricePerGram.toLocaleString()}</td>
        <td>${totalPrice.toLocaleString()}</td>
      </tr>
    </table>
  `;
}

window.onload = async () => {
  const currentPrice = await fetchGoldPrice();
  if (!currentPrice) return;
  document.getElementById('currentPrice').innerText =
    `현재 금 1g당 가격: ${currentPrice.toLocaleString()}원`;
};
</script>
